function rgb2hex(e){return e=e.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i),e&&4===e.length?"#"+("0"+parseInt(e[1],10).toString(16)).slice(-2)+("0"+parseInt(e[2],10).toString(16)).slice(-2)+("0"+parseInt(e[3],10).toString(16)).slice(-2):""}function resize(){var e=$(window).height(),a=$(window).width();$("html, body").height(e).width(a),$("#cesiumContainer, .cesium-viewer, .control-sidebar").height(e),$(".map-layers-window").height(e-30),$("#cesiumContainer").hasClass("control-sidebar-open")?$("#cesiumContainer, .cesium-viewer").width(a-420):$("#cesiumContainer, .cesium-viewer").width(a)}function toggleSidebar(){$(".control-sidebar").hasClass("control-sidebar-open")?($("#add").removeClass("active"),$(".control-sidebar, #cesiumContainer").removeClass("control-sidebar-open")):($("#add").addClass("active"),$(".control-sidebar, #cesiumContainer").addClass("control-sidebar-open")),resize()}function startupSidebar(){$(window).width()<769?$("#add").addClass("flashit").one("click",function(){$(this).removeClass("flashit")}):toggleSidebar()}function toggleTimeline(e){if(e)animationContainer.show(),timelineContainer.addClass("show"),$("#toggle-timeline").addClass("active");else if(timelineContainer.is(":visible"))animationContainer.hide(),timelineContainer.removeClass("show"),$("#toggle-timeline").removeClass("active");else{animationContainer.show(),timelineContainer.addClass("show");var a=Cesium.JulianDate.fromDate(new Date(Date.UTC(2012,4,8))),i=Cesium.JulianDate.now();viewer.timeline.zoomTo(a,i),$("#toggle-timeline").addClass("active")}}function getURLParameter(e){for(var a=decodeURIComponent(window.location.search.substring(1)).split("&"),i=0;i<a.length;i++){var t=a[i].split("=");if(t[0]==e)return t[1]}}function loading(e){$("."+e+"-load").removeClass("fa-eye-slash").addClass("fa-spinner fa-spin loading active")}function loaded(e){$("."+e+"-load").removeClass("fa-spinner fa-spin loading").addClass("fa-eye"),$("."+e+"-tree").trigger("click")}function loadError(e,a,i){var t=$("#"+e);$('<div class="details"><div class="header"><i class="fa fa-fw fa-exclamation-circle"></i> Load Failed</div>Please use <a href="mailto:jim@climateviewer.com?subject=Climate Viewer 3D broken link - '+e+"&amp;body=Unfortunately this ( "+a+' ) URL is not working properly, please look into it.  Sent from http://climateviewer.org/3D/" target="_self">this link</a> to report this error.<br><div class="darkwell"><strong>ERROR:</strong> '+i+"</div></div>").appendTo(t);var r=$("."+e+"-load"),n=$("#"+e+" span");r.removeClass("fa-spinner fa-spin active loading").addClass("fa-exclamation-triangle fail"),n.removeClass("active").addClass("fail")}function NSlider(e){var a=e.src,i=e.mod;(e=e||{}).element||(e.element=$('<div class="item slider"></div>')),e.min||(e.min=0),e.max||(e.max=1),e.start||(e.start=1),e.label||(e.label=""),$('<div class="label">'+e.label+"</div>").appendTo(e.element);var t=$('<input class="'+e.label+'" type="range">').appendTo(e.element),r=e.start/e.max*100;return t.attr("min",0),t.attr("max",100),t.attr("step",1),t.attr("value",r),t.on("change",function(){var r=(t.val()/100).toFixed(2),n=e.max*r;if(i)for(var s=a.entities.values,o=0;o<s.length;o++){var l=s[o],c=l.billboard.color;"alpha"==i&&(l.billboard.color=new Cesium.Color.fromAlpha(c,n))}else"opacity"==e.label&&(a.alpha=n),"contrast"==e.label&&(a.contrast=n),"saturation"==e.label&&(a.saturation=n),"brightness"==e.label&&(a.brightness=n),"gamma"==e.label&&(a.gamma=n)}),e.element}function loadSliders(e,a){var i=$("#"+a+" .lb"),t=$('<div class="details '+a+'-sliders layer-sliders" />').insertAfter(i),r=$('<div class="slider-content" />').appendTo(t),n=$('<div class="ui divided list" />').appendTo(r);NSlider({label:"opacity",src:e}).appendTo(n),NSlider({max:2,label:"brightness",src:e}).appendTo(n),NSlider({max:2,label:"contrast",src:e}).appendTo(n),NSlider({max:2,label:"saturation",src:e}).appendTo(n),e.alpha=1,e.brightness=1,e.contrast=1,e.saturation=1,loaded(a)}function loadGIBS(e,a,i,t){removeImagery(e);var r=viewer.imageryLayers.addImageryProvider(new Cesium.WebMapTileServiceImageryProvider({url:"https://gibs.earthdata.nasa.gov/wmts/epsg3857/best/wmts.cgi?TIME="+a,layer:e,style:"",format:i,tileMatrixSetID:"GoogleMapsCompatible_Level"+t,minimumLevel:0,maximumLevel:t,tileWidth:256,tileHeight:256,tilingScheme:new Cesium.WebMercatorTilingScheme}));activeLayers[e]=r,$("."+e+"-sliders").remove(),loadSliders(r,e)}function loadWmts(e,a,i){var t=viewer.imageryLayers.addImageryProvider(new Cesium.WebMapTileServiceImageryProvider({url:a,layers:i,style:"",format:"image/png",tileMatrixSetID:"GoogleMapsCompatible_Level9",maximumLevel:9,tileWidth:256,tileHeight:256,tilingScheme:new Cesium.WebMercatorTilingScheme}));activeLayers[e]=t,loadSliders(t,e)}function loadWms(e,a,i,t){var r;r=t?viewer.imageryLayers.addImageryProvider(new Cesium.WebMapServiceImageryProvider({url:a,layers:i,proxy:{getURL:function(e){return proxyURL+encodeURIComponent(e)}},sourceUri:a,enablePickFeatures:!1,tilingScheme:new Cesium.WebMercatorTilingScheme,parameters:{transparent:!0,format:"image/png"}})):viewer.imageryLayers.addImageryProvider(new Cesium.WebMapServiceImageryProvider({url:a,layers:i,proxy:{getURL:function(e){return proxyURL+encodeURIComponent(e)}},sourceUri:a,tilingScheme:new Cesium.WebMercatorTilingScheme,parameters:{transparent:!0,format:"image/png"}})),activeLayers[e]=r,loadSliders(r,e)}function loadOsmLayer(e,a){var i=viewer.imageryLayers.addImageryProvider(new Cesium.createOpenStreetMapImageryProvider({url:a}));activeLayers[e]=i,loadSliders(i,e)}function loadCartoDB(e,a){var i=viewer.imageryLayers.addImageryProvider(new Cesium.UrlTemplateImageryProvider({url:a}));activeLayers[e]=i,loadSliders(i,e)}function loadBingLayer(e,a){var i,t="//dev.virtualearth.net",r="AiQDjsWpddVOFEnVY6j4Jb0S0Hoy9QMa30rvbZT1A8qd0it10NkYAgvb5sa3OeLw";i="AERIAL"==a?viewer.imageryLayers.addImageryProvider(new Cesium.BingMapsImageryProvider({url:t,key:r,mapStyle:Cesium.BingMapsStyle.AERIAL})):"AERIAL_WITH_LABELS"==a?viewer.imageryLayers.addImageryProvider(new Cesium.BingMapsImageryProvider({url:t,key:r,mapStyle:Cesium.BingMapsStyle.AERIAL_WITH_LABELS})):viewer.imageryLayers.addImageryProvider(new Cesium.BingMapsImageryProvider({url:t,key:r,mapStyle:Cesium.BingMapsStyle.ROADS})),activeLayers[e]=i,loadSliders(i,e)}function newMarkerLabel(e,a){var i=new Cesium.LabelGraphics;return"usgs-eq"==a?i.text="M"+e.properties.mag:e.label.text?i.text=e.label.text:i.text="",i.horizontalOrigin=Cesium.HorizontalOrigin.CENTER,i.verticalOrigin=Cesium.VerticalOrigin.BOTTOM,i.outlineWidth=5,i.style=Cesium.LabelStyle.FILL_AND_OUTLINE,i.translucencyByDistance=defaultTranslucency,i.eyeOffset=defaultKMLEyeOffset,i}function modMarkers(e,a,i,t,r,n){var s,o;if(!1===n){var l=$("."+e+"-details");o=$('<div class="details '+e+'-list marker-list" />').insertAfter(l),s=[]}for(var c=a.entities.values,d=0;d<c.length;d++){var m=c[d],u=new Cesium.BillboardGraphics,p="/dist/img/icons/cv3d.png";void 0!==m.name?name=m.name:name="unnamed location",i?p=i:void 0!==m.billboard&&void 0!==m.billboard.image&&(p=m.billboard.image),u.image=p;var g;g="usgs-eq"==r?m.properties.mag:t||3,u.scale=g;var h="";m.properties.title?h="<h3>"+m.properties.title+"</h3>":m.properties.Name?h="<h3>"+m.properties.Name+"</h3>":m.properties.name?h="<h3>"+m.properties.name+"</h3>":m.properties.LICENSEE&&(h="<h3>"+m.properties.LICENSEE+"</h3>"),m.title=h;var v="";if(m.properties.mag?v="<div>Place: "+m.properties.place+"<br>Magnitude: "+m.properties.mag+'<br><a href="'+m.properties.url+'" target="_blank">Click here for more info.</a></div>':m.properties.Description?v="<div>"+m.properties.Description+"</div>":m.properties.description?v="<div>"+m.properties.description+"</div>":m.properties.desc?v="<div>"+m.properties.desc+"</div>":m.properties.FREQUENCY&&(v="<div>FREQUENCY: "+m.properties.FREQUENCY+"<br>CALLSIGN: "+m.properties.CALLSIGN+"<br>SERVICE: "+m.properties.SERVICE+"<br></div>"),m.description=v,u.width=32,u.height=32,u.alignedAxis=Cesium.Cartesian3.ZERO,u.scaleByDistance=defaultScaleByDistance,m.billboard=u,!1===n){var f=m.position.getValue(),y=Cesium.Ellipsoid.WGS84.cartesianToCartographic(f),b=Cesium.Math.toDegrees(y.longitude),w=Cesium.Math.toDegrees(y.latitude);s.push('<li data-lon="'+b+'"  data-lat="'+w+'"><canvas width="20" height="20" class="marker-icon" data-src="'+p+'"></canvas> &nbsp;'+name+"</li>")}}!1===n&&($('<h5><i class="fa fa-fw fa-map-marker"></i> Map Markers <span>Click to fly to location</span></h5>').appendTo(o),$("<ol/>",{class:"markers",html:s.join("")}).appendTo(o),$(".markers li").click(function(){var e=$(this).attr("data-lon"),a=$(this).attr("data-lat");viewer.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(e,a,3e3)})}),$("."+e+"-list li canvas.marker-icon").each(function(){var e=$(this).attr("data-src"),a=document.createElement("canvas");a.width=20,a.height=20;a.getContext("2d");var i=$(this)[0].getContext("2d"),t=new Image;t.width=20,t.height=20,t.onload=function(){i.drawImage(t,0,0,t.width=20,t.height=20),i.globalAlpha=1,i.drawImage(a,0,0)},t.src=e}))}function modKML(e,a,i){for(var t=a.entities.values,r=[],n=$("."+e+"-details"),s=$('<div class="details '+e+'-list marker-list" />').insertAfter(n),o=0;o<t.length;o++){var l=t[o];if(void 0!==l.billboard&&void 0!==l.billboard.image){c=void 0!==l.name?l.name:"unnamed location",l.billboard.scale=i||3,l.billboard.width=32,l.billboard.height=32,l.billboard.alignedAxis=Cesium.Cartesian3.ZERO,l.billboard.scaleByDistance=defaultScaleByDistance;var c,d,m=l.position.getValue(),u=Cesium.Ellipsoid.WGS84.cartesianToCartographic(m),p=Cesium.Math.toDegrees(u.longitude),g=Cesium.Math.toDegrees(u.latitude);if(void 0!==l.billboard.color){console.log("marker has color");var h=l.billboard.color.getValue(),v=[];$.each(h,function(e,a){"red"!==e&&"green"!==e&&"blue"!==e||v.push(255*a)}),d=rgb2hex("rgba("+v.join(", ")+",1)")}else d="none";var f=l.billboard.image.getValue();r.push('<li data-lon="'+p+'"  data-lat="'+g+'"><canvas width="20" height="20" class="marker-icon" data-src="'+f+'" data-tint="'+d+'"></canvas> &nbsp;'+c+"</li>")}}$('<h5><i class="fa fa-fw fa-map-marker"></i> Map Markers <span>Click to fly to location</span></h5>').appendTo(s),$("<ol/>",{class:"markers",html:r.join("")}).appendTo(s),$("."+e+"-list li").click(function(){var e=$(this).attr("data-lon"),a=$(this).attr("data-lat");viewer.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(e,a,1500)})}),$("."+e+"-list li canvas.marker-icon").each(function(){var e=$(this).attr("data-tint"),a=$(this).attr("data-src"),i=document.createElement("canvas");i.width=20,i.height=20;var t=i.getContext("2d"),r=$(this)[0].getContext("2d"),n=new Image;n.onload="none"!==e?function(){t.fillStyle=e,t.fillRect(0,0,20,20),t.globalCompositeOperation="destination-atop",t.drawImage(n,0,0),r.drawImage(n,0,0,n.width=20,n.height=20),r.globalAlpha=.9,r.drawImage(i,0,0)}:function(){r.drawImage(n,0,0,n.width=20,n.height=20),r.globalAlpha=1,r.drawImage(i,0,0)},n.src=a})}function loadArcGisLayer(e,a,i,t,r){var n;n=t?viewer.imageryLayers.addImageryProvider(new Cesium.ArcGisMapServerImageryProvider({url:a,format:r,enablePickFeatures:!1,layers:i,tilingScheme:new Cesium.WebMercatorTilingScheme})):viewer.imageryLayers.addImageryProvider(new Cesium.ArcGisMapServerImageryProvider({url:a,format:r,enablePickFeatures:!0,layers:i,tilingScheme:new Cesium.WebMercatorTilingScheme})),activeLayers[e]=n,loadSliders(n,e),loaded(e)}function loadGeoJson(e,a,i,t,r,n,s){new Cesium.GeoJsonDataSource.load(a).then(function(a){modMarkers(e,a,r,t,i,s),viewer.dataSources.add(a),activeLayers[e]=a,n&&(!0===n?viewer.flyTo(a):$(".cesium-home-button").trigger("click")),loaded(e)},function(i){loadError(e,a,i)})}function loadKml(e,a,i,t,r,n,s,o){i?new Cesium.KmlDataSource.load(a,{proxy:{getURL:function(e){return proxyURL+encodeURIComponent(e)}},sourceUri:a,camera:viewer.scene.camera,canvas:viewer.scene.canvas,clampToGround:!0}).then(function(a){console.log("loaded proxied kml"),o&&modKML(e,a,n),console.log("modified kml"),viewer.dataSources.add(a),activeLayers[e]=a,t&&(!0===t?viewer.flyTo(a):$(".cesium-home-button").trigger("click")),loaded(e)},function(i){loadError(e,a,i)}):new Cesium.KmlDataSource.load(a,{camera:viewer.scene.camera,canvas:viewer.scene.canvas,clampToGround:!0}).then(function(a){console.log("loaded proxied kml"),o&&modKML(e,a,n),console.log("modified kml"),viewer.dataSources.add(a),activeLayers[e]=a,t&&(!0===t?viewer.flyTo(a):$(".cesium-home-button").trigger("click")),loaded(e)},function(i){loadError(e,a,i)})}function removeImagery(e){var a=activeLayers[e];delete activeLayers[e],viewer.imageryLayers.remove(a,!1)}function disableLayer(e){var a=e.I,i=e.T;if(void 0!==layerEnabled[e.I]){if("nasa-gibs"===i||"cartodb-layer"===i||"wmts"===i||"wms"===i||"base-layer"===i||"arcgis-layer"===i||"arcgis-base-layer"===i||"bing"===i)removeImagery(a),$("."+a+"-sliders").remove();else{var t=activeLayers[a];delete activeLayers[a],viewer.dataSources.remove(t)}"geojson"!==i&&"kml"!==i||($("."+a+"-tree").removeClass("active"),$("."+a+"-list").remove()),delete layerEnabled[a]}}function updateLayer(e,a){loading(e);var i=me.node(e);i||console.error("missing layer",e);var t,r=i.G,n=i.L,s=i.M,o=i.MI,l=i.MS,c=i.ML,d=i.C,m=i.Y,u=i.F,p=i.Fz,g=i.P,h=i.X,v=picker.get("select","yyyy-mm-dd");a||(t=i.Z),n=n||"0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,",p=p||"9",u="jpg"===u?"image/jpeg":"image/png",m=!!m,void 0===layerEnabled[e]&&(layerEnabled[e]=!1,"wms"===i.T?loadWms(e,r,n,h):"nasa-gibs"===i.T?loadGIBS(e,v,u,p):"wmts"===i.T?loadWmts(e,r,n):"cartodb-layer"===i.T?loadCartoDB(e,r):"base-layer"===i.T?loadOsmLayer(e,r):"arcgis-layer"===i.T||"arcgis-base-layer"===i.T?loadArcGisLayer(e,r,n,h,u):"geojson"===i.T?loadGeoJson(e,r,c,l,o,t,m):"kml"===i.T?loadKml(e,r,g,t,o,l,c,s):"bing"===i.T?loadBingLayer(e,r):console.log(e+" failed to load map type: "+i.T),d&&toggleTimeline(!0))}function newFolderLabel(e,a,i,t){var r;r=i?'<i class="fa fa-fw '+i+'"></i>':"";var n=$("<h2>").addClass("toggle").html(r+"<span>"+e.N+"</span>").click(function(){a.is(":visible")?(a.hide(),n.removeClass("active")):(a.show(),n.addClass("active"))});return t&&n.prop("id",t).addClass("layer-category"),n}function initDetails(e,a,i,t,r,n){var s=$('<div class="details '+e+'-content" />').appendTo(i);$('<div class="header"><i class="fa fa-fw fa-info-circle"></i> Layer Details</div><span>'+t+' &bull; <a href="'+r+'" target="_blank" rel="nofollow">More Info</a></span>').appendTo(s),"kml"==a&&$('<div class="header"><i class="fa fa-fw fa-download"></i> Data Source</div><span>Keyhole Markup Language (KML) &bull; <a href="'+n+'">Download</a></span>').appendTo(s),"geojson"==a&&$('<div class="header"><i class="fa fa-fw fa-download"></i> Data Source</div><span>GeoJSON &bull; <a href="'+n+'">Download</a></span>').appendTo(s),"nasa-gibs"==a&&$('<div class="header"><i class="fa fa-fw fa-file-o"></i> Data Source</div><span>Web Map Tile Service (WMTS)</span>').appendTo(s),"wms"==a&&$('<div class="header"><i class="fa fa-fw fa-file-o"></i> Data Source</div><span>Web Mapping Service (WMS)<br><a target="_blank" rel="nofollow" href="'+n+'?request=GetCapabilities&service=WMS">Get Capabilities</a></span>').appendTo(s),"base-layer"==a&&$('<div class="header"><i class="fa fa-fw fa-file-o"></i> Data Source</div><span>OpenStreetMap (OSM) Base Map</span>').appendTo(s),"arcgis-layer"!=a&&"arcgis-base-layer"!=a||$('<div class="header"><i class="fa fa-fw fa-file-o"></i> Data Source</div><span>ArcGIS MapServer<br><a target="_blank" rel="nofollow" href="'+n+'/legend">Map Legend</a> &bull; <a target="_blank" rel="nofollow" href="'+n+'">MapServer Information</a></span>>').appendTo(s),$('<div class="header"><i class="fa fa-share-square-o fa-fw"></i> Share This Layer</div><span>Use this url to share this layer: <a href="/index.html?layersOn='+e+'" target="_self">Share Link</a></span><div class="header"><i class="fa fa-exclamation-triangle fa-fw"></i> Report Error</div><span>If you are experiencing problems loading this layer, or you would like to suggest corrections, comments, or concerns, please email me using this link: <a href="mailto:jim@climateviewer.com?subject=ClimateViewer broken link - '+e+"&amp;body=Unfortunately this ( "+e+' ) map is not working properly, please look into it. Sent from http://climateviewer.org/" target="_self">Report Error</a></span>').appendTo(s)}function addTree(e,a,i){var t=me.successors(e);return _.each(t,function(e){var t,r=me.node(e),n=r.I,s=r.T,o=$('<div class="folder" />').html(r);if(r.T){var l,c,d,m,u,p,g,h=r.G,v=r.S,f=r.U,y=r.H,b=r.NL,w=r.M,C=r.C,T=r.F,k=r.Fz,M=r.Y;!0!==M&&(M=!1),w=!!w,k=k||"9",t=(T="jpg"===T?"image/jpeg":"image/png")?$("<div>").data("l",r).attr({id:r.I,"data-format":T,"data-zoom":k}).addClass("lbw "+r.T):$("<div>").data("l",r).attr("id",r.I).addClass("lbw "+r.T),l=$("<div>").addClass("lb").appendTo(t),m=$("<i>").addClass("fa fa-fw fa-info-circle").toggle(function(){0===c.children().length&&initDetails(n,s,c,v,f,h),c.show(),c.focus(),m.addClass("active")},function(){c.hide(),m.removeClass("active")}).appendTo(l),("geojson"===r.T&&!1===M||"kml"===r.T&&!0===w)&&(u=$('<i title="Expand Marker Tree" class="fa fa-fw fa-sitemap toggle-list '+n+'-tree"></i>')).click(function(){setTimeout(function(){$("."+n+"-list").is(":visible")?($("."+n+"-list").hide(),u.removeClass("active")):($("."+n+"-list").show(),u.addClass("active"))})}).appendTo(l),"nasa-gibs"!==r.T&&"cartodb-layer"!==r.T&&"wmts"!==r.T&&"wms"!==r.T&&"base-layer"!==r.T&&"arcgis-layer"!==r.T&&"arcgis-base-layer"!==r.T&&"bing"!==r.T||(p=$('<i title="Expand Marker Tree" class="fa fa-fw fa-sliders toggle-list '+n+'-tree"></i>')).click(function(){setTimeout(function(){$("."+n+"-sliders").is(":visible")?($("."+n+"-sliders").hide(),p.removeClass("show-sliders")):($("."+n+"-sliders").show(),p.addClass("show-sliders"))})}).appendTo(l),d=$('<i class="fa fa-fw fa-eye-slash '+n+'-load"></i>'),y&&d.addClass("large-layer"),b&&d.addClass("new-layer"),d.toggle(function(){setTimeout(function(){d.hasClass("fa-eye-slash")&&(i?updateLayer(n,i):updateLayer(n),g.hasClass("active")||g.addClass("active"),t.hasClass("active")||t.addClass("active"),C&&toggleTimeline(!0),("geojson"===r.T&&!1===M||"kml"===r.T&&!0===w)&&u.show(),"nasa-gibs"!==r.T&&"cartodb-layer"!==r.T&&"wmts"!==r.T&&"wms"!==r.T&&"base-layer"!==r.T&&"arcgis-layer"!==r.T&&"arcgis-base-layer"!==r.T&&"bing"!==r.T||p.show())})},function(){setTimeout(function(){d.hasClass("fa-eye")&&(disableLayer(r),d.removeClass("fa-eye active").addClass("fa-eye-slash"),g.hasClass("active")&&g.removeClass("active"),t.hasClass("active")&&t.removeClass("active"),m.hasClass("fa-folder-open-o")&&m.trigger("click"),("geojson"===r.T&&!1===M||"kml"===r.T&&!0===w)&&u.hide(),"nasa-gibs"!==r.T&&"cartodb-layer"!==r.T&&"wmts"!==r.T&&"wms"!==r.T&&"base-layer"!==r.T&&"arcgis-layer"!==r.T&&"arcgis-base-layer"!==r.T&&"bing"!==r.T||(p.hide(),p.removeClass("show-sliders")))})}).appendTo(l),(g=$("<span>").html(r.N).addClass("label")).toggle(function(){g.hasClass("fail")||(g.hasClass("active")||g.addClass("active"),d.trigger("click"))},function(){g.hasClass("fail")||(g.hasClass("active")&&g.removeClass("active"),d.trigger("click"))}).appendTo(l),(c=$('<div class="'+n+'-details layer-details" />').appendTo(t)).hide()}else{var L=r.icon,S=r.id;t=newFolderLabel(r,o,L,S)}null!==t&&(a.append(t),addTree(r.I,o,i).length&&a.append(o))}),t}function countLayers(){var e=$("#map-layers div.lbw").length,a=$("#active-layers div.lbw").length;console.log(a),$("#active-layers").is(":visible")?"0"==a?$("#layer-count").html("No Active Maps"):"1"==a?$("#layer-count").html(a+" Map"):$("#layer-count").html(a+" Maps"):$("#layer-count").html(e+" Maps")}function initLayers(e){var a=$("#map-layers");a.addClass("ui"),e?_.each(me.sources(),function(i){addTree(i,a,e)}):_.each(me.sources(),function(e){addTree(e,a)}),countLayers()}function bit_url(e){var a=e;$.ajax({url:"https://api-ssl.bitly.com/v3/shorten",data:{longUrl:a,access_token:"b5c2d6d1704074b0741a7449a98e3fcef2790699",login:"r3zn8d"},dataType:"jsonp",success:function(e){var a=e.data.url;$("#share-short").val(a)}})}function shareLink(){var e="",a=shareURL;if($(".lbw.active").each(function(){var a=$(this).attr("id");e+=a+","}),a+="index.html?",e.length>0&&(a+="layersOn="+(e=e.substring(0,e.length-1))),a+="&baseLayer="+$(".cesium-baseLayerPicker-selectedItem").prop("id"),$(".cesium-sceneModePicker-wrapper button:first-of-type").hasClass("cesium-sceneModePicker-button3D")){var i=viewer.scene.camera,t=new Cesium.Cartesian2(viewer.container.clientWidth/2,viewer.container.clientHeight/2),r=viewer.scene.camera.getPickRay(t),n=viewer.scene.globe.pick(r,viewer.scene),s=viewer.scene.globe.ellipsoid.cartesianToCartographic(n),o=i.positionCartographic.height,l=s.longitude*(180/Math.PI),c=s.latitude*(180/Math.PI);a+="&lat="+l.toFixed(5),a+="&lon="+c.toFixed(5),a+="&zoom="+o.toFixed(2),a+="&mode=3D",console.log("3D")}else $(".cesium-sceneModePicker-wrapper button:first-of-type").hasClass("cesium-sceneModePicker-button2D")?(a+="&mode=2D",console.log("2D")):$(".cesium-sceneModePicker-wrapper button:first-of-type").hasClass("cesium-sceneModePicker-buttonColumbusView")&&(a+="&mode=flat",console.log("Columbus View"));a+="&date="+picker.get("select","yyyy-mm-dd"),$("#share-link").val(a),$("#share-embed").val('<iframe src="'+a+'" title="ClimateViewer 3D embedded map via ClimateViewer.org" style="width:100%;min-height:300px;display:block;position:relative;"></iframe>');encodeURIComponent(a);bit_url(a)}function isEmpty(e){return!$.trim(e.html())}!function(e){"use strict";function a(e,i){if(!(this instanceof a)){var t=new a(e,i);return t.open(),t}this.id=a.id++,this.setup(e,i),this.chainCallbacks(a._callbackChain)}if(void 0!==e){var i=[],t=function(a){return i=e.grep(i,function(e){return e!==a&&e.$instance.closest("body").length>0})},r=function(e,a){var i={},t=new RegExp("^"+a+"([A-Z])(.*)");for(var r in e){var n=r.match(t);n&&(i[(n[1]+n[2].replace(/([A-Z])/g,"-$1")).toLowerCase()]=e[r])}return i},n={keyup:"onKeyUp",resize:"onResize"},s=function(i){e.each(a.opened().reverse(),function(){return i.isDefaultPrevented()||!1!==this[n[i.type]](i)?void 0:(i.preventDefault(),i.stopPropagation(),!1)})},o=function(i){if(i!==a._globalHandlerInstalled){a._globalHandlerInstalled=i;var t=e.map(n,function(e,i){return i+"."+a.prototype.namespace}).join(" ");e(window)[i?"on":"off"](t,s)}};a.prototype={constructor:a,namespace:"featherlight",targetAttr:"data-featherlight",variant:null,resetCss:!1,background:null,openTrigger:"click",closeTrigger:"click",filter:null,root:"body",openSpeed:250,closeSpeed:250,closeOnClick:"background",closeOnEsc:!0,closeIcon:"&#10005;",loading:"",persist:!1,otherClose:null,beforeOpen:e.noop,beforeContent:e.noop,beforeClose:e.noop,afterOpen:e.noop,afterContent:e.noop,afterClose:e.noop,onKeyUp:e.noop,onResize:e.noop,type:null,contentFilters:["jquery","image","html","ajax","iframe","text"],setup:function(a,i){"object"!=typeof a||a instanceof e!=0||i||(i=a,a=void 0);var t=e.extend(this,i,{target:a}),r=t.resetCss?t.namespace+"-reset":t.namespace,n=e(t.background||['<div class="'+r+"-loading "+r+'">','<div class="'+r+'-content">','<button class="'+r+"-close-icon "+t.namespace+'-close" aria-label="Close">',t.closeIcon,"</button>",'<div class="'+t.namespace+'-inner">'+t.loading+"</div>","</div>","</div>"].join("")),s="."+t.namespace+"-close"+(t.otherClose?","+t.otherClose:"");return t.$instance=n.clone().addClass(t.variant),t.$instance.on(t.closeTrigger+"."+t.namespace,function(a){var i=e(a.target);("background"===t.closeOnClick&&i.is("."+t.namespace)||"anywhere"===t.closeOnClick||i.closest(s).length)&&(t.close(a),a.preventDefault())}),this},getContent:function(){if(!1!==this.persist&&this.$content)return this.$content;var a=this,i=this.constructor.contentFilters,t=function(e){return a.$currentTarget&&a.$currentTarget.attr(e)},r=t(a.targetAttr),n=a.target||r||"",s=i[a.type];if(!s&&n in i&&(s=i[n],n=a.target&&r),n=n||t("href")||"",!s)for(var o in i)a[o]&&(s=i[o],n=a[o]);if(!s){var l=n;if(n=null,e.each(a.contentFilters,function(){return(s=i[this]).test&&(n=s.test(l)),!n&&s.regex&&l.match&&l.match(s.regex)&&(n=l),!n}),!n)return"console"in window&&window.console.error("Featherlight: no content filter found "+(l?' for "'+l+'"':" (no target specified)")),!1}return s.process.call(a,n)},setContent:function(a){var i=this;return(a.is("iframe")||e("iframe",a).length>0)&&i.$instance.addClass(i.namespace+"-iframe"),i.$instance.removeClass(i.namespace+"-loading"),i.$instance.find("."+i.namespace+"-inner").not(a).slice(1).remove().end().replaceWith(e.contains(i.$instance[0],a[0])?"":a),i.$content=a.addClass(i.namespace+"-inner"),i},open:function(a){var t=this;if(t.$instance.hide().appendTo(t.root),!(a&&a.isDefaultPrevented()||!1===t.beforeOpen(a))){a&&a.preventDefault();var r=t.getContent();if(r)return i.push(t),o(!0),t.$instance.fadeIn(t.openSpeed),t.beforeContent(a),e.when(r).always(function(e){t.setContent(e),t.afterContent(a)}).then(t.$instance.promise()).done(function(){t.afterOpen(a)})}return t.$instance.detach(),e.Deferred().reject().promise()},close:function(a){var i=this,r=e.Deferred();return!1===i.beforeClose(a)?r.reject():(0===t(i).length&&o(!1),i.$instance.fadeOut(i.closeSpeed,function(){i.$instance.detach(),i.afterClose(a),r.resolve()})),r.promise()},resize:function(e,a){if(e&&a){this.$content.css("width","").css("height","");var i=Math.max(e/(parseInt(this.$content.parent().css("width"),10)-1),a/(parseInt(this.$content.parent().css("height"),10)-1));i>1&&(i=a/Math.floor(a/i),this.$content.css("width",e/i+"px").css("height",a/i+"px"))}},chainCallbacks:function(a){for(var i in a)this[i]=e.proxy(a[i],this,e.proxy(this[i],this))}},e.extend(a,{id:0,autoBind:"[data-featherlight]",defaults:a.prototype,contentFilters:{jquery:{regex:/^[#.]\w/,test:function(a){return a instanceof e&&a},process:function(a){return!1!==this.persist?e(a):e(a).clone(!0)}},image:{regex:/\.(png|jpg|jpeg|gif|tiff|bmp|svg)(\?\S*)?$/i,process:function(a){var i=this,t=e.Deferred(),r=new Image,n=e('<img src="'+a+'" alt="" class="'+i.namespace+'-image" />');return r.onload=function(){n.naturalWidth=r.width,n.naturalHeight=r.height,t.resolve(n)},r.onerror=function(){t.reject(n)},r.src=a,t.promise()}},html:{regex:/^\s*<[\w!][^<]*>/,process:function(a){return e(a)}},ajax:{regex:/./,process:function(a){var i=e.Deferred(),t=e("<div></div>").load(a,function(e,a){"error"!==a&&i.resolve(t.contents()),i.fail()});return i.promise()}},iframe:{process:function(a){var i=new e.Deferred,t=e("<iframe/>");return t.hide().attr("src",a).css(r(this,"iframe")).on("load",function(){i.resolve(t.show())}).appendTo(this.$instance.find("."+this.namespace+"-content")),i.promise()}},text:{process:function(a){return e("<div>",{text:a})}}},functionAttributes:["beforeOpen","afterOpen","beforeContent","afterContent","beforeClose","afterClose"],readElementConfig:function(a,i){var t=this,r=new RegExp("^data-"+i+"-(.*)"),n={};return a&&a.attributes&&e.each(a.attributes,function(){var a=this.name.match(r);if(a){var i=this.value,s=e.camelCase(a[1]);if(e.inArray(s,t.functionAttributes)>=0)i=new Function(i);else try{i=JSON.parse(i)}catch(e){}n[s]=i}}),n},extend:function(a,i){var t=function(){this.constructor=a};return t.prototype=this.prototype,a.prototype=new t,a.__super__=this.prototype,e.extend(a,this,i),a.defaults=a.prototype,a},attach:function(a,i,t){var r=this;"object"!=typeof i||i instanceof e!=0||t||(t=i,i=void 0);var n,s=(t=e.extend({},t)).namespace||r.defaults.namespace,o=e.extend({},r.defaults,r.readElementConfig(a[0],s),t);return a.on(o.openTrigger+"."+o.namespace,o.filter,function(s){var l=e.extend({$source:a,$currentTarget:e(this)},r.readElementConfig(a[0],o.namespace),r.readElementConfig(this,o.namespace),t),c=n||e(this).data("featherlight-persisted")||new r(i,l);"shared"===c.persist?n=c:!1!==c.persist&&e(this).data("featherlight-persisted",c),l.$currentTarget.blur(),c.open(s)}),a},current:function(){var e=this.opened();return e[e.length-1]||null},opened:function(){var a=this;return t(),e.grep(i,function(e){return e instanceof a})},close:function(e){var a=this.current();return a?a.close(e):void 0},_onReady:function(){var a=this;a.autoBind&&(e(a.autoBind).each(function(){a.attach(e(this))}),e(document).on("click",a.autoBind,function(i){i.isDefaultPrevented()||"featherlight"===i.namespace||(i.preventDefault(),a.attach(e(i.currentTarget)),e(i.target).trigger("click.featherlight"))}))},_callbackChain:{onKeyUp:function(a,i){return 27===i.keyCode?(this.closeOnEsc&&e.featherlight.close(i),!1):a(i)},beforeOpen:function(a,i){return this._previouslyActive=document.activeElement,this._$previouslyTabbable=e("a, input, select, textarea, iframe, button, iframe, [contentEditable=true]").not("[tabindex]").not(this.$instance.find("button")),this._$previouslyWithTabIndex=e("[tabindex]").not('[tabindex="-1"]'),this._previousWithTabIndices=this._$previouslyWithTabIndex.map(function(a,i){return e(i).attr("tabindex")}),this._$previouslyWithTabIndex.add(this._$previouslyTabbable).attr("tabindex",-1),document.activeElement.blur(),a(i)},afterClose:function(a,i){var t=a(i),r=this;return this._$previouslyTabbable.removeAttr("tabindex"),this._$previouslyWithTabIndex.each(function(a,i){e(i).attr("tabindex",r._previousWithTabIndices[a])}),this._previouslyActive.focus(),t},onResize:function(e,a){return this.resize(this.$content.naturalWidth,this.$content.naturalHeight),e(a)},afterContent:function(e,a){var i=e(a);return this.$instance.find("[autofocus]:not([disabled])").focus(),this.onResize(a),i}}}),e.featherlight=a,e.fn.featherlight=function(e,i){return a.attach(this,e,i)},e(document).ready(function(){a._onReady()})}else"console"in window&&window.console.info("Too much lightness, Featherlight needs jQuery.")}(jQuery);var shareURL="http://climateviewer.org/",proxyURL="/proxy.php?";$(window).resize(function(){resize()}).on("resize orientationchange",function(e){resize()}).trigger("resize"),$("#add").on("click",function(){toggleSidebar()}),startupSidebar(),$(".panel-toggle").on("click",function(){var e=$(this).attr("id"),a=$("."+e);$(this).find("i");$.featherlight(a),$(".panel-toggle").removeClass("active"),$(this).addClass("active")});var imageryViewModels=[];Cesium.BingMapsApi.defaultKey="AiQDjsWpddVOFEnVY6j4Jb0S0Hoy9QMa30rvbZT1A8qd0it10NkYAgvb5sa3OeLw",imageryViewModels.push(new Cesium.ProviderViewModel({name:"Dark Matter",iconUrl:"/dist/img/dark-matter.jpg",tooltip:"Map tiles by CartoDB, under CC BY 3.0. Data by OpenStreetMap, under ODbL.",creationFunction:function(){return new Cesium.UrlTemplateImageryProvider({url:"http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png",credit:"Map tiles by CartoDB, under CC BY 3.0. Data by OpenStreetMap, under ODbL."})}})),imageryViewModels.push(new Cesium.ProviderViewModel({name:"ESRI Aerial",iconUrl:Cesium.buildModuleUrl("Widgets/Images/ImageryProviders/esriWorldImagery.png"),tooltip:"World Imagery provides one meter or better satellite and aerial imagery in many parts of the world and lower resolution satellite imagery worldwide. www.esri.com",creationFunction:function(){return new Cesium.ArcGisMapServerImageryProvider({url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",enablePickFeatures:!1})}})),imageryViewModels.push(new Cesium.ProviderViewModel({name:"ESRI NatGeo",iconUrl:Cesium.buildModuleUrl("Widgets/Images/ImageryProviders/esriNationalGeographic.png"),tooltip:"National Geographic World Map service. www.esri.com",creationFunction:function(){return new Cesium.ArcGisMapServerImageryProvider({url:"http://services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/",enablePickFeatures:!1})}})),imageryViewModels.push(new Cesium.ProviderViewModel({name:"Bing Aerial",iconUrl:Cesium.buildModuleUrl("Widgets/Images/ImageryProviders/bingAerialLabels.png"),tooltip:"Bing Maps aerial imagery with label overlays \nhttp://www.bing.com/maps",creationFunction:function(){return new Cesium.BingMapsImageryProvider({url:"http://dev.virtualearth.net",key:"AiQDjsWpddVOFEnVY6j4Jb0S0Hoy9QMa30rvbZT1A8qd0it10NkYAgvb5sa3OeLw",mapStyle:Cesium.BingMapsStyle.AERIAL_WITH_LABELS})}})),imageryViewModels.push(new Cesium.ProviderViewModel({name:"CV Blue",iconUrl:"/dist/img/cv-blue.jpg",tooltip:"CartoDB World Flat Blue. Map tiles by CartoDB, under CC BY 3.0. Data by OpenStreetMap, under ODbL.",creationFunction:function(){return new Cesium.UrlTemplateImageryProvider({url:"https://cartocdn_{s}.global.ssl.fastly.net/base-flatblue/{z}/{x}/{y}.png",credit:"Map tiles by CartoDB, under CC BY 3.0. Data by OpenStreetMap, under ODbL."})}})),imageryViewModels.push(new Cesium.ProviderViewModel({name:"Watercolor",iconUrl:Cesium.buildModuleUrl("Widgets/Images/ImageryProviders/stamenWatercolor.png"),tooltip:"Reminiscent of hand drawn maps maps.stamen.com",creationFunction:function(){return new Cesium.UrlTemplateImageryProvider({url:"http://tile.stamen.com/watercolor/{z}/{x}/{y}.jpg",credit:"Map tiles by Stamen Design, under CC BY 3.0. Data by OpenStreetMap, under CC BY SA."})}})),imageryViewModels.push(new Cesium.ProviderViewModel({name:"Bing Roads",iconUrl:Cesium.buildModuleUrl("Widgets/Images/ImageryProviders/bingRoads.png"),tooltip:"Bing Maps standard road maps\nhttp://www.bing.com/maps",creationFunction:function(){return new Cesium.BingMapsImageryProvider({url:"http://dev.virtualearth.net",key:"AiQDjsWpddVOFEnVY6j4Jb0S0Hoy9QMa30rvbZT1A8qd0it10NkYAgvb5sa3OeLw",mapStyle:Cesium.BingMapsStyle.ROAD})}})),imageryViewModels.push(new Cesium.ProviderViewModel({name:"ESRI Street",iconUrl:Cesium.buildModuleUrl("Widgets/Images/ImageryProviders/esriWorldStreetMap.png"),tooltip:"Worldwide street map presents highway-level data for the world. www.esri.com",creationFunction:function(){return new Cesium.ArcGisMapServerImageryProvider({url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",enablePickFeatures:!1})}})),imageryViewModels.push(new Cesium.ProviderViewModel({name:"DeLorme",iconUrl:"/dist/img/esri-ocean.jpg",tooltip:"Includes bathymetry, marine water body names, undersea feature names, and derived depth values in meters.",creationFunction:function(){return new Cesium.ArcGisMapServerImageryProvider({url:"http://services.arcgisonline.com/arcgis/rest/services/Ocean_Basemap/MapServer",enablePickFeatures:!1})}})),imageryViewModels.push(new Cesium.ProviderViewModel({name:"Positron",iconUrl:"/dist/img/positron.jpg",tooltip:"Map tiles by CartoDB, under CC BY 3.0. Data by OpenStreetMap, under ODbL.",creationFunction:function(){return new Cesium.UrlTemplateImageryProvider({url:"http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",credit:"Map tiles by CartoDB, under CC BY 3.0. Data by OpenStreetMap, under ODbL."})}})),imageryViewModels.push(new Cesium.ProviderViewModel({name:"Toner Lite",iconUrl:"/dist/img/toner-lite.jpg",tooltip:"A high contrast black and white map.\nhttp://maps.stamen.com",creationFunction:function(){return new Cesium.UrlTemplateImageryProvider({url:"http://tile.stamen.com/toner-lite/{z}/{x}/{y}.png",credit:"Map tiles by Stamen Design, under CC BY 3.0. Data by OpenStreetMap, under CC BY SA."})}})),imageryViewModels.push(new Cesium.ProviderViewModel({name:"Toner",iconUrl:Cesium.buildModuleUrl("Widgets/Images/ImageryProviders/stamenToner.png"),tooltip:"A high contrast black and white map.\nhttp://maps.stamen.com",creationFunction:function(){return new Cesium.UrlTemplateImageryProvider({url:"http://tile.stamen.com/toner/{z}/{x}/{y}.png",credit:"Map tiles by Stamen Design, under CC BY 3.0. Data by OpenStreetMap, under CC BY SA."})}})),imageryViewModels.push(new Cesium.ProviderViewModel({name:"Midnight",iconUrl:"/dist/img/midnight-commander.jpg",tooltip:"CartoDB World Midnight Commander. Map tiles by CartoDB, under CC BY 3.0. Data by OpenStreetMap, under ODbL.",creationFunction:function(){return new Cesium.UrlTemplateImageryProvider({url:"https://cartocdn_{s}.global.ssl.fastly.net/base-midnight/{z}/{x}/{y}.png",credit:"Map tiles by CartoDB, under CC BY 3.0. Data by OpenStreetMap, under ODbL."})}})),imageryViewModels.push(new Cesium.ProviderViewModel({name:"Black Marble",iconUrl:Cesium.buildModuleUrl("Widgets/Images/ImageryProviders/blackMarble.png"),tooltip:"The lights of cities and villages trace the outlines of civilization in this global view of the Earth at night as seen by NASA/NOAA's Suomi NPP satellite.",creationFunction:function(){return new Cesium.createTileMapServiceImageryProvider({url:"https://cesiumjs.org/blackmarble",credit:"Black Marble imagery courtesy NASA Earth Observatory",flipXY:!0})}}));var terrainProviders=[];terrainProviders.push(new Cesium.ProviderViewModel({name:"Flat Terrain",iconUrl:"/dist/img/flat-terrain.png",tooltip:"WGS84 standard ellipsoid, also known as EPSG:4326",creationFunction:function(){return new Cesium.EllipsoidTerrainProvider}})),terrainProviders.push(new Cesium.ProviderViewModel({name:"3D Terrain",iconUrl:"/dist/img/3d-terrain.png",tooltip:"STK High-resolution, mesh-based terrain for the entire globe. Free for use on the Internet. Closed-network options are available.\nhttp://www.agi.com",creationFunction:function(){return new Cesium.CesiumTerrainProvider({url:"//assets.agi.com/stk-terrain/world",requestWaterMask:!0,requestVertexNormals:!0})}}));var now=Cesium.JulianDate.now(),clock=new Cesium.Clock({currentTime:now}),viewer=new Cesium.Viewer("cesiumContainer",{sceneModePicker:!0,timeline:!0,animation:!0,sceneMode:Cesium.SceneMode.SCENE3D,navigationHelpButton:!1,navigationInstructionsInitiallyVisible:!1,imageryProvider:!1,baseLayerPicker:!1,clock:clock,terrainProvider:!1});viewer.extend(Cesium.viewerCesiumNavigationMixin,{});var deviceAgent=navigator.userAgent.toLowerCase(),agentID=deviceAgent.match(/(iphone|ipod|ipad)/);agentID&&(viewer.resolutionScale=1/devicePixelRatio,viewer.scene.fxaa=!1);var baseLayerPicker=new Cesium.BaseLayerPicker("baseLayerPickerContainer",{globe:viewer.scene,imageryProviderViewModels:imageryViewModels,terrainProviderViewModels:terrainProviders}),animationContainer=$(".cesium-viewer-animationContainer"),timelineContainer=$(".cesium-viewer-timelineContainer"),credit=$(".cesium-viewer-bottom");animationContainer.hide(),timelineContainer.hide(),$("#timeline").click(function(){toggleTimeline()}),$("#sunlight").toggle(function(e){e.preventDefault(),viewer.scene.globe.enableLighting=!0,$(this).addClass("active")},function(e){e.preventDefault(),viewer.scene.globe.enableLighting=!1,$(this).removeClass("active")});var startTime=Cesium.JulianDate.fromDate(new Date(Date.UTC(2012,4,8))),endTime=Cesium.JulianDate.now();viewer.timeline.zoomTo(startTime,endTime);var activeLayers={},infoBox=$(".cesium-infoBox"),layerEnabled={},me=new Self;nobjectsIn(layers,function(e){},function(e,a,i){me.addEdge(e,a,i)});var date=new Date;date.setDate(date.getDate()-1);var yesterday=Cesium.JulianDate.fromDate(date),startdate=Cesium.JulianDate.toDate(yesterday),$input=$("#datepicker").pickadate({format:"mmmm d, yyyy",formatSubmit:"yyyy-mm-dd",min:[2002,6,1],max:Cesium.JulianDate.now(),container:"#datepicker-container",closeOnSelect:!0,closeOnClear:!1,selectYears:!0,selectMonths:!0}),picker=$input.pickadate("picker");picker.set("select",startdate),picker.on({set:function(){var e=picker.get("select","yyyy-mm-dd");$(".nasa-gibs.active").each(function(){loadGIBS($(this).attr("id"),e,$(this).attr("data-format"),$(this).attr("data-zoom"))})}});var start=picker.get("select","yyyy-mm-dd"),previousTime=null,isoDate=function(e){return e.split("T")[0]},isoDateTime=clock.currentTime.toString(),time="TIME="+isoDate(isoDateTime),onClockUpdate=_.throttle(function(){isoDateTime=clock.currentTime.toString(),(time=isoDate(isoDateTime))!==previousTime&&(previousTime=time,picker.set("select",time,{format:"yyyy-mm-dd"}))},250,{leading:!0,trailing:!0});viewer.clock.onTick.addEventListener(onClockUpdate),onClockUpdate(),$("#distanceLegendDiv").before('<div class="legend-cap" title="Distance Legend"></div>').attr("title","Distance Legend"),$(".distance-legend").addClass("noselect"),$("#cv").on("click",function(){$("#about").toggle()});var defaultKMLEyeOffset=new Cesium.Cartesian3(0,5e3,0),defaultScaleByDistance=new Cesium.NearFarScalar(1,.5,1,.3),defaultTranslucency=new Cesium.NearFarScalar(150,1,3e6,0);$(".cesium-baseLayerPicker-item").each(function(){var e=$(this).find($(".cesium-baseLayerPicker-itemLabel")),a=encodeURIComponent(e.html());$(this).prop("id",a)});var initialLayers=(getURLParameter("layersOn")||"").split(","),disabledLayers=(getURLParameter("layersOff")||"").split(",");""===initialLayers[0]&&(initialLayers=[]),""===disabledLayers[0]&&(disabledLayers=[]);var allLayers=initialLayers.concat(disabledLayers),baseLayer=getURLParameter("baseLayer")||"";if(baseLayer.length>0){console.log("yes + "+baseLayer);var baseLayerId=encodeURIComponent(baseLayer);console.log(baseLayerId),$("div[id='"+baseLayerId+"']").trigger("click")}if(allLayers.length>0){var latView=getURLParameter("lat")||"-78.176832746519",lonView=getURLParameter("lon")||"31.300283760032368",zoomView=getURLParameter("zoom")||"26596280.257583864",dateView=getURLParameter("date")||time;if(dateView!==time&&picker.set("select",dateView,{format:"yyyy-mm-dd"}),"-78.176832746519"!==latView){var includeOnly=!0;initLayers(includeOnly),viewer.camera.flyTo({destination:Cesium.Cartesian3.fromDegrees(latView,lonView,zoomView)})}else initLayers();var modeView=getURLParameter("mode")||"3D";"3D"!==modeView&&("2D"===modeView?viewer.scene.morphTo2D():"flat"===modeView&&viewer.scene.morphToColumbusView());var shared=$('<div class="folder" style="display: block;"></div>').prependTo("#map-layers");$('<h2 class="toggle active">Shared Layers</h2>').prependTo("#map-layers").show();for(var i=0;i<allLayers.length;i++)$("#"+allLayers[i]).detach().appendTo(shared).show();for(var i=0;i<initialLayers.length;i++)$("."+initialLayers[i]+"-load").click()}else initLayers();bit_url("http://climateviewer.org/"),$("#share").on("click",function(){shareLink()}),$("#share-modal input").on("click",function(){$(this).select()}),$(".map-options .menu-item").hover(function(){var e=$(this).attr("id");$("div.menu-hover span.menu-label").hide(),$("div.menu-hover span.menu-label."+e).show()},function(){$("div.menu-hover span.menu-label").hide(),$("div.menu-hover span.menu-label.layers").show()}),$("#about-toggle").click(function(e){e.preventDefault(),$("#about").is(":visible")?($("#about").hide(),$(this).removeClass("active")):($("#about").show(),$(this).addClass("active"))}),$("#chat").click(function(e){e.preventDefault();var a=$(window).width(),i=$(window).height();return a<420||i<600?(window.open("https://tlk.io/cvnews","","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height="+(i-100)+",width="+a),!1):(window.open("https://tlk.io/cvnews","","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=420"),!1)}),$("#clear").on("click",function(){$("#map-layers i.active").trigger("click")}),$(".cesium-viewer-fullscreenContainer").click(function(){resize()}),$("#close-menu").on("click",function(){toggleSidebar()}),$("#collapse-menu").on("click",function(){$("i.fa-sitemap.active").trigger("click"),$(".fa-folder-open-o.active").trigger("click"),$("h2.active").trigger("click")}),$("#top-layers").on("click",function(){$(".map-layers-window").animate({scrollTop:$("#top").offset().top-90},500)}),$(".cesium-baseLayerPicker-dropDown").addClass("cesium-baseLayerPicker-dropDown-visible").detach().appendTo($("#base")),$(".cesium-widget-credits").detach().appendTo($(".cv-footer")),$(".cesium-viewer-toolbar").detach().appendTo($(".navigation-controls")),$(".cesium-viewer-geocoderContainer").detach().prependTo($(".search")),$(".cesium-geocoder-input").addClass("cesium-geocoder-input-wide"),$(".map-options").detach().appendTo($("#cesiumContainer")),$("#active-layers-toggle").toggle(function(){$(".lbw.active").each(function(){var e=$(this).prop("id");$('<span id="'+e+'-holder" style="display: none;" />').insertAfter($(this)),$(this).detach().appendTo("#active-layers")}),$(this).html('<i class="fa fa-2x fa-map-marker"></i> <span>Showing Active</span>'),isEmpty($("#active-layers"))&&$("#active-layers").html('<div class="about text-center"><h3><i style="color:#F00" class="fa fa-fw fa-exclamation-triangle"></i> NO ACTIVE LAYERS SELECTED</h3><p>Try turning on a map layer by clicking the <i class="fa fa-fw fa-eye-slash"></i> icon.</p></div>'),$("#active-layers").show(),$("#map-layers").hide(),countLayers()},function(){$("#active-layers .lbw.active").each(function(){var e=$(this).prop("id");$(this).detach().insertBefore($("#"+e+"-holder")),$("#"+e+"-holder").remove()}),$("#active-layers").html(""),$(this).html('<i class="fa fa-2x fa-map-marker"></i> <span>Showing All</span>'),$("#active-layers").hide(),$("#map-layers").show(),countLayers()}),$(".logo").appendTo($("#cesiumContainer")),$("style").remove(),$("#cesiumContainer, div.map-options, span.menu-label.layers").show(),$("#instructions").on("click",function(){$(".youtube").each(function(){var e=$(this).data("id");$(this).css("background-image","url(http://i.ytimg.com/vi/"+e+"/sddefault.jpg)"),$(this).append($("<div/>",{class:"play"})),$(this).click(function(){var a="https://www.youtube.com/embed/"+e+"?autoplay=1&autohide=1";$(this).data("params")&&(a+="&"+$(this).data("params"));var i=$("<iframe/>",{frameborder:"0",src:a});i.attr("allowFullScreen",""),$(this).hide(),i.insertAfter($(this))})}).show()}),resize(),$('<link type="text/css" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700">').appendTo($("head")),$("body").addClass("gfont");
